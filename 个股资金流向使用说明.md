# 个股资金流向（moneyflow_dc）使用说明

## 接口简介

**接口名称**: moneyflow_dc

**数据来源**: 东方财富

**数据说明**:
- 获取个股资金流向数据
- 每日盘后更新
- 数据开始于 2023-09-11
- 单次最大获取 6000 条数据
- **积分要求**: 需要至少 5000 积分

## 数据字段

| 字段名 | 类型 | 说明 |
|--------|------|------|
| trade_date | str | 交易日期 |
| ts_code | str | 股票代码 |
| name | str | 股票名称 |
| pct_change | float | 涨跌幅 |
| close | float | 最新价 |
| net_amount | float | 今日主力净流入额（万元） |
| net_amount_rate | float | 今日主力净流入净占比（%） |
| buy_elg_amount | float | 今日超大单净流入额（万元） |
| buy_elg_amount_rate | float | 今日超大单净流入占比（%） |
| buy_lg_amount | float | 今日大单净流入额（万元） |
| buy_lg_amount_rate | float | 今日大单净流入占比（%） |
| buy_md_amount | float | 今日中单净流入额（万元） |
| buy_md_amount_rate | float | 今日中单净流入占比（%） |
| buy_sm_amount | float | 今日小单净流入额（万元） |
| buy_sm_amount_rate | float | 今日小单净流入占比（%） |

## 使用方法

### 1. 下载数据

```python
from tushare_db import DataDownloader

downloader = DataDownloader()

# 方式1：下载单日全部股票数据
rows = downloader.download_moneyflow_dc(trade_date='20241011')
print(f"下载了 {rows} 条数据")

# 方式2：下载单个股票的历史数据
rows = downloader.download_moneyflow_dc(
    ts_code='002149.SZ',
    start_date='20240901',
    end_date='20240913'
)
print(f"下载了 {rows} 条数据")

# 方式3：下载多个股票的数据（按日期范围）
rows = downloader.download_moneyflow_dc(
    start_date='20241001',
    end_date='20241031'
)
print(f"下载了 {rows} 条数据")
```

### 2. 查询数据

```python
from tushare_db import DataReader

reader = DataReader()

# 查询1：查询单日所有股票的资金流向
df = reader.get_moneyflow_dc(trade_date='20241011')
print(df.head())

# 查询2：查询单个股票的历史资金流向
df = reader.get_moneyflow_dc(
    ts_code='002149.SZ',
    start_date='20240901',
    end_date='20240913'
)
print(df)

# 查询3：查询指定日期范围内的所有数据
df = reader.get_moneyflow_dc(
    start_date='20241001',
    end_date='20241010'
)
print(df)

# 查询4：查询单个股票的最新数据
df = reader.get_moneyflow_dc(
    ts_code='000001.SZ',
    trade_date='20241011'
)
print(df)

reader.close()
```

## 数据分析示例

### 示例1：查找主力净流入最大的股票

```python
from tushare_db import DataReader

reader = DataReader()

# 查询某日数据
df = reader.get_moneyflow_dc(trade_date='20241011')

# 按主力净流入排序
top10 = df.nlargest(10, 'net_amount')[
    ['ts_code', 'name', 'pct_change', 'close', 'net_amount', 'net_amount_rate']
]

print("主力净流入 Top 10:")
print(top10)

reader.close()
```

### 示例2：分析个股资金流向趋势

```python
from tushare_db import DataReader
import pandas as pd

reader = DataReader()

# 查询个股历史数据
ts_code = '002149.SZ'
df = reader.get_moneyflow_dc(
    ts_code=ts_code,
    start_date='20240901',
    end_date='20240930'
)

# 统计分析
print(f"股票: {ts_code}")
print(f"分析期间: {df['trade_date'].min()} - {df['trade_date'].max()}")
print(f"\n资金流向统计:")
print(f"  主力净流入总额: {df['net_amount'].sum():.2f} 万元")
print(f"  主力净流入平均: {df['net_amount'].mean():.2f} 万元")
print(f"  净流入为正天数: {(df['net_amount'] > 0).sum()} / {len(df)} 天")

# 找出最大净流入和净流出的日期
max_inflow_date = df.loc[df['net_amount'].idxmax(), 'trade_date']
max_inflow = df['net_amount'].max()
max_outflow_date = df.loc[df['net_amount'].idxmin(), 'trade_date']
max_outflow = df['net_amount'].min()

print(f"\n  最大净流入: {max_inflow:.2f} 万元 ({max_inflow_date})")
print(f"  最大净流出: {max_outflow:.2f} 万元 ({max_outflow_date})")

reader.close()
```

### 示例3：市场整体资金流向分析

```python
from tushare_db import DataReader

reader = DataReader()

# 查询某日全部股票数据
df = reader.get_moneyflow_dc(trade_date='20241011')

# 市场统计
total_net_amount = df['net_amount'].sum()
inflow_count = (df['net_amount'] > 0).sum()
outflow_count = (df['net_amount'] < 0).sum()

print(f"市场资金流向概况 (20241011):")
print(f"  总股票数: {len(df)}")
print(f"  净流入股票数: {inflow_count} ({inflow_count/len(df)*100:.1f}%)")
print(f"  净流出股票数: {outflow_count} ({outflow_count/len(df)*100:.1f}%)")
print(f"  市场总净流入: {total_net_amount:.2f} 万元")

# 超大单、大单、中单、小单统计
print(f"\n各类资金流向:")
print(f"  超大单净流入: {df['buy_elg_amount'].sum():.2f} 万元")
print(f"  大单净流入: {df['buy_lg_amount'].sum():.2f} 万元")
print(f"  中单净流入: {df['buy_md_amount'].sum():.2f} 万元")
print(f"  小单净流入: {df['buy_sm_amount'].sum():.2f} 万元")

reader.close()
```

### 示例4：资金流向与涨跌幅的关系分析

```python
from tushare_db import DataReader
import pandas as pd

reader = DataReader()

# 查询数据
df = reader.get_moneyflow_dc(trade_date='20241011')

# 过滤掉停牌和无效数据
df = df[df['close'] > 0].copy()

# 分组统计
# 将股票按主力净流入分为四类
df['category'] = pd.cut(
    df['net_amount_rate'],
    bins=[-100, -5, 0, 5, 100],
    labels=['大幅流出', '小幅流出', '小幅流入', '大幅流入']
)

# 统计各类别的涨跌情况
stats = df.groupby('category').agg({
    'ts_code': 'count',
    'pct_change': 'mean',
    'net_amount': 'mean'
})

print("资金流向与涨跌幅关系:")
print(stats)

reader.close()
```

## 注意事项

1. **积分要求**: 该接口需要至少 5000 积分，请确保账户积分充足
2. **数据限制**: 单次最大获取 6000 条数据，如需获取大量数据请分批查询
3. **数据起始日期**: 数据从 2023-09-11 开始
4. **更新频率**: 每日盘后更新
5. **资金单位**: 所有资金流向数据单位为"万元"

## 批量下载建议

如果需要下载大量历史数据，建议使用循环分批下载：

```python
from tushare_db import DataDownloader, DataReader
from datetime import datetime, timedelta

downloader = DataDownloader()

# 获取股票列表
reader = DataReader()
stocks = reader.query("SELECT ts_code FROM stock_basic WHERE list_status = 'L'")
reader.close()

# 定义日期范围
start_date = '20231001'
end_date = '20231031'

# 分批下载
for ts_code in stocks['ts_code']:
    try:
        rows = downloader.download_moneyflow_dc(
            ts_code=ts_code,
            start_date=start_date,
            end_date=end_date
        )
        print(f"{ts_code}: {rows} 条数据")
    except Exception as e:
        print(f"{ts_code}: 下载失败 - {e}")
```

## 相关接口

- `moneyflow_ind_dc`: 行业资金流向数据
- `dc_member`: 龙虎榜机构席位数据
- `dc_index`: 板块指数数据

## 测试脚本

项目包含完整的测试脚本 `test_moneyflow_dc.py`，可以运行该脚本验证功能：

```bash
python test_moneyflow_dc.py
```

测试脚本会执行以下测试：
1. 下载单日全部股票数据
2. 下载单个股票的历史数据
3. 查询单日数据
4. 查询单个股票历史数据
5. 数据字段完整性检查

## 更新日期

2025-12-26
