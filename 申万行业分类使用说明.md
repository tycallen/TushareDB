# 申万行业分类（index_classify）使用说明

## 接口简介

**接口名称**: index_classify

**数据来源**: Tushare Pro

**数据说明**:
- 获取申万行业分类数据
- 支持申万2014版（SW2014）和申万2021版（SW2021）
- 包含L1（一级）、L2（二级）、L3（三级）三个层级
- 数据相对稳定，无需频繁更新

## 数据字段

| 字段名 | 类型 | 说明 |
|--------|------|------|
| index_code | str | 指数代码 |
| industry_name | str | 行业名称 |
| level | str | 行业级别（L1/L2/L3） |
| industry_code | str | 行业代码（唯一标识） |
| is_pub | int | 是否发布指数（1=是，0=否） |
| parent_code | str | 父级代码（L1的parent_code为0） |
| src | str | 分类来源（SW） |

## 使用方法

### 1. 下载数据

```python
from tushare_db import DataDownloader

downloader = DataDownloader()

# 方式1：下载申万2021版L1一级行业
rows = downloader.download_index_classify(level='L1', src='SW2021')
print(f"下载了 {rows} 条数据")

# 方式2：下载申万2021版L2二级行业
rows = downloader.download_index_classify(level='L2', src='SW2021')
print(f"下载了 {rows} 条数据")

# 方式3：下载申万2021版L3三级行业
rows = downloader.download_index_classify(level='L3', src='SW2021')
print(f"下载了 {rows} 条数据")

# 方式4：下载申万2014版所有行业
for level in ['L1', 'L2', 'L3']:
    rows = downloader.download_index_classify(level=level, src='SW2014')
    print(f"下载了 SW2014 {level} {rows} 条数据")

downloader.close()
```

### 2. 查询数据

```python
from tushare_db import DataReader

reader = DataReader()

# 查询1：查询所有L1一级行业（申万2021版）
df = reader.get_index_classify(level='L1', src='SW2021')
print(df)

# 查询2：查询所有L2二级行业（申万2021版）
df = reader.get_index_classify(level='L2', src='SW2021')
print(df)

# 查询3：查询特定L1行业下的所有L2二级行业
# 例如：查询"农林牧渔"行业下的二级行业
df = reader.get_index_classify(level='L2', parent_code='110000', src='SW2021')
print(df)

# 查询4：查询特定行业代码的信息
df = reader.get_index_classify(industry_code='110000')
print(df)

# 查询5：查询申万2014版的所有L1行业
df = reader.get_index_classify(level='L1', src='SW2014')
print(df)

reader.close()
```

## 数据分析示例

### 示例1：查看行业层级结构

```python
from tushare_db import DataReader

reader = DataReader()

# 获取L1一级行业
df_l1 = reader.get_index_classify(level='L1', src='SW2021')

print("申万2021版 L1一级行业:")
print(df_l1[['industry_code', 'industry_name']])
print(f"\n共 {len(df_l1)} 个一级行业")

# 获取每个一级行业下的二级行业数量
print("\n各一级行业的二级行业数量:")
for _, row in df_l1.iterrows():
    industry_code = row['industry_code']
    industry_name = row['industry_name']

    df_l2 = reader.get_index_classify(
        level='L2',
        parent_code=industry_code,
        src='SW2021'
    )

    print(f"{industry_name} ({industry_code}): {len(df_l2)} 个二级行业")

reader.close()
```

### 示例2：构建行业分类树

```python
from tushare_db import DataReader

reader = DataReader()

def build_industry_tree(src='SW2021'):
    """构建行业分类树"""
    # 获取所有层级数据
    df_l1 = reader.get_index_classify(level='L1', src=src)
    df_l2 = reader.get_index_classify(level='L2', src=src)
    df_l3 = reader.get_index_classify(level='L3', src=src)

    print(f"申万{src[-4:]}版行业分类树:\n")

    for _, l1 in df_l1.iterrows():
        l1_code = l1['industry_code']
        l1_name = l1['industry_name']
        print(f"L1: {l1_code} - {l1_name}")

        # 二级行业
        df_l2_sub = df_l2[df_l2['parent_code'] == l1_code]
        for _, l2 in df_l2_sub.iterrows():
            l2_code = l2['industry_code']
            l2_name = l2['industry_name']
            print(f"  L2: {l2_code} - {l2_name}")

            # 三级行业
            df_l3_sub = df_l3[df_l3['parent_code'] == l2_code]
            for _, l3 in df_l3_sub.iterrows():
                l3_code = l3['industry_code']
                l3_name = l3['industry_name']
                print(f"    L3: {l3_code} - {l3_name}")

        print()  # 空行分隔

build_industry_tree('SW2021')
reader.close()
```

### 示例3：比较SW2014和SW2021版本差异

```python
from tushare_db import DataReader

reader = DataReader()

# 获取两个版本的L1行业
df_2014 = reader.get_index_classify(level='L1', src='SW2014')
df_2021 = reader.get_index_classify(level='L1', src='SW2021')

print("申万行业分类版本比较:")
print(f"\nSW2014版 L1行业数量: {len(df_2014)}")
print(f"SW2021版 L1行业数量: {len(df_2021)}")

print("\nSW2014版行业列表:")
for _, row in df_2014.iterrows():
    print(f"  {row['industry_code']} - {row['industry_name']}")

print("\nSW2021版行业列表:")
for _, row in df_2021.iterrows():
    print(f"  {row['industry_code']} - {row['industry_name']}")

# 统计各层级数量
for src in ['SW2014', 'SW2021']:
    print(f"\n{src}版本统计:")
    for level in ['L1', 'L2', 'L3']:
        df = reader.get_index_classify(level=level, src=src)
        print(f"  {level}: {len(df)} 个行业")

reader.close()
```

### 示例4：根据行业代码查询行业信息

```python
from tushare_db import DataReader

reader = DataReader()

def get_industry_full_info(industry_code: str):
    """获取行业的完整信息（包括父级信息）"""
    # 查询当前行业
    df = reader.get_index_classify(industry_code=industry_code)

    if df.empty:
        print(f"未找到行业代码: {industry_code}")
        return

    info = df.iloc[0]
    print(f"行业代码: {info['industry_code']}")
    print(f"行业名称: {info['industry_name']}")
    print(f"行业级别: {info['level']}")
    print(f"父级代码: {info['parent_code']}")
    print(f"指数代码: {info['index_code']}")
    print(f"是否发布指数: {'是' if info['is_pub'] == 1 else '否'}")
    print(f"分类来源: {info['src']}")

    # 如果有父级，查询父级信息
    if info['parent_code'] != '0':
        df_parent = reader.get_index_classify(industry_code=info['parent_code'])
        if not df_parent.empty:
            parent_info = df_parent.iloc[0]
            print(f"\n父级行业: {parent_info['industry_name']} ({parent_info['industry_code']})")

    # 如果不是L3，查询子级信息
    if info['level'] != 'L3':
        next_level = 'L2' if info['level'] == 'L1' else 'L3'
        df_children = reader.get_index_classify(
            level=next_level,
            parent_code=industry_code,
            src=info['src']
        )

        if not df_children.empty:
            print(f"\n下级行业数量: {len(df_children)}")
            print("下级行业列表:")
            for _, child in df_children.iterrows():
                print(f"  {child['industry_code']} - {child['industry_name']}")

# 示例：查询"农林牧渔"行业的完整信息
get_industry_full_info('110000')

reader.close()
```

## 注意事项

1. **版本选择**: 建议使用申万2021版（SW2021），这是最新的分类标准
2. **数据更新**: 行业分类数据相对稳定，不需要频繁更新
3. **层级关系**:
   - L1是一级行业，parent_code为0
   - L2是二级行业，parent_code为对应的L1行业代码
   - L3是三级行业，parent_code为对应的L2行业代码
4. **指数发布**: 并非所有行业都发布指数，通过is_pub字段判断

## 批量下载建议

推荐一次性下载所有数据：

```python
from tushare_db import DataDownloader

downloader = DataDownloader()

# 下载申万2021版所有层级
for level in ['L1', 'L2', 'L3']:
    rows = downloader.download_index_classify(level=level, src='SW2021')
    print(f"下载 SW2021 {level}: {rows} 条")

# 下载申万2014版所有层级
for level in ['L1', 'L2', 'L3']:
    rows = downloader.download_index_classify(level=level, src='SW2014')
    print(f"下载 SW2014 {level}: {rows} 条")

downloader.close()
```

## 相关接口

- `index_weight`: 指数成分和权重数据
- `index_basic`: 指数基础信息
- `stock_basic`: 股票基础信息

## 测试脚本

项目包含完整的测试脚本 `test_index_classify.py`，可以运行该脚本验证功能：

```bash
python test_index_classify.py
```

测试脚本会执行以下测试：
1. 下载SW2021版L1/L2/L3行业数据
2. 下载SW2014版L1行业数据
3. 查询L1/L2行业数据
4. 查询特定父级下的子级行业
5. 比较SW2014和SW2021版本差异
6. 数据字段完整性检查

## 更新日期

2025-12-26
