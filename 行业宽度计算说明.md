# è¡Œä¸šå®½åº¦å¾—åˆ†è®¡ç®—è¯´æ˜

## æ ¸å¿ƒæ¦‚å¿µ

**å¸‚åœºå®½åº¦ï¼ˆMarket Breadthï¼‰** æ˜¯è¡¡é‡å¸‚åœºä¸­ä¸Šæ¶¨è‚¡ç¥¨å æ¯”çš„æŠ€æœ¯æŒ‡æ ‡ï¼Œåæ˜ å¸‚åœºå‚ä¸çš„å¹¿åº¦å’Œè¶‹åŠ¿çš„å¥åº·ç¨‹åº¦ã€‚

## è®¡ç®—å…¬å¼

### å•ä¸ªè¡Œä¸šçš„å®½åº¦å¾—åˆ†

```
è¡Œä¸šå®½åº¦å¾—åˆ† = (è¡Œä¸šå†…ä¸Šæ¶¨è‚¡ç¥¨æ•°é‡ / è¡Œä¸šå†…æ€»è‚¡ç¥¨æ•°é‡) Ã— 100
```

**å–å€¼èŒƒå›´**ï¼š0 - 100

**å«ä¹‰**ï¼š
- 100ï¼šè¯¥è¡Œä¸šæ‰€æœ‰è‚¡ç¥¨éƒ½ä¸Šæ¶¨ï¼ˆæå¼ºï¼‰
- 50ï¼šè¯¥è¡Œä¸šä¸€åŠè‚¡ç¥¨ä¸Šæ¶¨ï¼ˆä¸­æ€§ï¼‰
- 0ï¼šè¯¥è¡Œä¸šæ‰€æœ‰è‚¡ç¥¨éƒ½ä¸‹è·Œï¼ˆæå¼±ï¼‰

### å¸‚åœºæ€»åˆ†

```
å¸‚åœºæ€»åˆ† = Î£(æ‰€æœ‰è¡Œä¸šçš„å®½åº¦å¾—åˆ†)
```

**å–å€¼èŒƒå›´**ï¼š0 - (è¡Œä¸šæ•°é‡ Ã— 100)

ä¾‹å¦‚ï¼š46ä¸ªè¡Œä¸šçš„æœ€å¤§æ€»åˆ† = 46 Ã— 100 = 4600

## è¯¦ç»†è®¡ç®—æ­¥éª¤

### æ­¥éª¤1ï¼šè·å–äº¤æ˜“æ—¥çš„æ‰€æœ‰è‚¡ç¥¨æ¶¨è·Œæ•°æ®

```python
# ä» pro_bar è¡¨è·å–æŸæ—¥æ‰€æœ‰è‚¡ç¥¨çš„æ¶¨è·Œå¹…
query = f"""
    SELECT ts_code, pct_chg
    FROM pro_bar
    WHERE trade_date = '20251216'
      AND pct_chg IS NOT NULL
"""
```

**æ•°æ®ç¤ºä¾‹**ï¼š
```
ts_code     pct_chg
000001.SZ   2.5      # ä¸Šæ¶¨
000002.SZ   -1.2     # ä¸‹è·Œ
000004.SZ   0.8      # ä¸Šæ¶¨
...
```

### æ­¥éª¤2ï¼šå…³è”è‚¡ç¥¨çš„è¡Œä¸šä¿¡æ¯

```python
# ä» stock_basic è¡¨è·å–è‚¡ç¥¨æ‰€å±è¡Œä¸š
# ç»“æœç¤ºä¾‹ï¼š
ts_code     pct_chg   industry
000001.SZ   2.5       é“¶è¡Œ
000002.SZ   -1.2      å…¨å›½åœ°äº§
600519.SH   1.8       ç™½é…’
...
```

### æ­¥éª¤3ï¼šæŒ‰è¡Œä¸šç»Ÿè®¡ä¸Šæ¶¨è‚¡ç¥¨å æ¯”

å¯¹æ¯ä¸ªè¡Œä¸šè¿›è¡Œç»Ÿè®¡ï¼š

```python
# ä»¥"é“¶è¡Œ"è¡Œä¸šä¸ºä¾‹
é“¶è¡Œè¡Œä¸šè‚¡ç¥¨åˆ—è¡¨ï¼š
- 000001.SZ å¹³å®‰é“¶è¡Œ   +2.5%  âœ“ ä¸Šæ¶¨
- 600000.SH æµ¦å‘é“¶è¡Œ   -0.5%  âœ— ä¸‹è·Œ
- 600036.SH æ‹›å•†é“¶è¡Œ   +1.2%  âœ“ ä¸Šæ¶¨
- 601398.SH å·¥å•†é“¶è¡Œ   +0.3%  âœ“ ä¸Šæ¶¨
- 601939.SH å»ºè®¾é“¶è¡Œ   -0.1%  âœ— ä¸‹è·Œ
... (å‡è®¾å…±30åª)

ç»Ÿè®¡ç»“æœï¼š
- æ€»è‚¡ç¥¨æ•°ï¼š30
- ä¸Šæ¶¨è‚¡ç¥¨æ•°ï¼š18
- è¡Œä¸šå®½åº¦å¾—åˆ† = (18 / 30) Ã— 100 = 60
```

### æ­¥éª¤4ï¼šè®¡ç®—å¸‚åœºæ€»åˆ†

```python
# æ±‡æ€»æ‰€æœ‰è¡Œä¸šå¾—åˆ†
è¡Œä¸š              è‚¡ç¥¨æ•°  ä¸Šæ¶¨æ•°  å¾—åˆ†
é“¶è¡Œ              30     18     60
è½¯ä»¶æœåŠ¡          120    72     60
åŠå¯¼ä½“            80     53     66
ç”µæ°”è®¾å¤‡          150    84     56
åŒ–å·¥åŸæ–™          100    45     45
...
æ€»è®¡ï¼ˆ46ä¸ªè¡Œä¸šï¼‰              2147  # å¸‚åœºæ€»åˆ†
```

## ä»£ç å®ç°

### æ ¸å¿ƒè®¡ç®—å‡½æ•°

```python
def calculate_industry_width(reader, trade_date, stock_industry_map):
    """
    è®¡ç®—æŒ‡å®šäº¤æ˜“æ—¥å„è¡Œä¸šçš„å¸‚åœºå®½åº¦

    å‚æ•°ï¼š
        reader: æ•°æ®åº“è¿æ¥
        trade_date: äº¤æ˜“æ—¥æœŸï¼ˆå¦‚ '20251216'ï¼‰
        stock_industry_map: è‚¡ç¥¨åˆ°è¡Œä¸šçš„æ˜ å°„

    è¿”å›ï¼š
        pd.Series - å„è¡Œä¸šçš„ä¸Šæ¶¨è‚¡ç¥¨å æ¯”ï¼ˆ0-100ï¼‰
    """
    # 1. è·å–å½“æ—¥æ‰€æœ‰è‚¡ç¥¨çš„æ¶¨è·Œå¹…
    query = f"""
        SELECT ts_code, pct_chg
        FROM pro_bar
        WHERE trade_date = '{trade_date}'
          AND pct_chg IS NOT NULL
    """
    df = reader.query(query)

    # 2. æ·»åŠ è¡Œä¸šä¿¡æ¯
    df['industry'] = df['ts_code'].map(stock_industry_map)
    df = df.dropna(subset=['industry'])

    # 3. æŒ‰è¡Œä¸šç»Ÿè®¡
    industry_stats = df.groupby('industry').agg(
        total_count=('pct_chg', 'count'),              # æ€»è‚¡ç¥¨æ•°
        up_count=('pct_chg', lambda x: (x > 0).sum())  # ä¸Šæ¶¨è‚¡ç¥¨æ•°
    )

    # 4. è®¡ç®—ä¸Šæ¶¨å æ¯”
    industry_stats['up_ratio'] = (
        industry_stats['up_count'] /
        industry_stats['total_count'] * 100
    ).round(0)

    return industry_stats['up_ratio']
```

## å®é™…æ¡ˆä¾‹åˆ†æ

### æ¡ˆä¾‹ï¼š2025-12-16 çš„å¸‚åœºå®½åº¦

**æ•°æ®**ï¼š
- äº¤æ˜“æ—¥ï¼š2025-12-16
- è¡Œä¸šæ•°ï¼š46 ä¸ª
- å¸‚åœºæ€»åˆ†ï¼š2139

**å„è¡Œä¸šå¾—åˆ†**ï¼ˆéƒ¨åˆ†ï¼‰ï¼š

| è¡Œä¸š | æ€»è‚¡ç¥¨æ•° | ä¸Šæ¶¨æ•° | ä¸‹è·Œæ•° | å¾—åˆ† | è§£è¯» |
|------|---------|--------|--------|------|------|
| èˆªç©º | 40 | 30 | 10 | 75 | æå¼º ğŸ”¥ |
| åŠå¯¼ä½“ | 100 | 65 | 35 | 65 | å¼ºåŠ¿ ğŸ“ˆ |
| é“¶è¡Œ | 30 | 12 | 18 | 40 | åå¼± ğŸ“‰ |
| ç«åŠ›å‘ç”µ | 32 | 6 | 26 | 19 | æå¼± â„ï¸ |

**å¸‚åœºæ€»åˆ†è®¡ç®—**ï¼š
```
æ€»åˆ† = 75 + 65 + 40 + 19 + ... (æ‰€æœ‰46ä¸ªè¡Œä¸š)
     = 2139
```

**å¸‚åœºçŠ¶æ€åˆ¤æ–­**ï¼š
```
å¹³å‡å¾—åˆ† = 2139 / 46 â‰ˆ 46.5

46.5 < 50 â†’ å¸‚åœºæ•´ä½“åå¼±ï¼Œä¸‹è·Œè‚¡ç¥¨å¤šäºä¸Šæ¶¨è‚¡ç¥¨
```

## æŒ‡æ ‡è§£è¯»

### å•ä¸ªè¡Œä¸šå¾—åˆ†è§£è¯»

| å¾—åˆ†èŒƒå›´ | å¸‚åœºçŠ¶æ€ | å»ºè®® |
|---------|---------|------|
| 80-100 | æå¼º ğŸ”¥ | è¡Œä¸šçƒ­åº¦é«˜ï¼Œå¯å…³æ³¨é¾™å¤´è‚¡ |
| 60-80 | å¼ºåŠ¿ ğŸ“ˆ | è¡Œä¸šæ•´ä½“å‘å¥½ï¼Œæœ‰æœºä¼š |
| 40-60 | ä¸­æ€§ â¡ï¸ | è¡Œä¸šåˆ†åŒ–ï¼Œéœ€ç²¾é€‰ä¸ªè‚¡ |
| 20-40 | åå¼± ğŸ“‰ | è¡Œä¸šæ‰¿å‹ï¼Œè°¨æ…å‚ä¸ |
| 0-20 | æå¼± â„ï¸ | è¡Œä¸šæ™®è·Œï¼Œè§„é¿ä¸ºä¸» |

### å¸‚åœºæ€»åˆ†è§£è¯»

ä»¥46ä¸ªè¡Œä¸šä¸ºä¾‹ï¼š

| æ€»åˆ†èŒƒå›´ | å¹³å‡å¾—åˆ† | å¸‚åœºçŠ¶æ€ | æ“ä½œå»ºè®® |
|---------|---------|---------|---------|
| 3200+ | 70+ | æ™®æ¶¨è¡Œæƒ… ğŸš€ | ç§¯æåšå¤š |
| 2760-3200 | 60-70 | å¤šå¤´å¸‚åœº ğŸ“ˆ | æŒè‚¡ä¸ºä¸» |
| 2300-2760 | 50-60 | éœ‡è¡åå¼º â¡ï¸ | é€‚åº¦å‚ä¸ |
| 1840-2300 | 40-50 | éœ‡è¡åå¼± ğŸ“‰ | è°¨æ…è§‚æœ› |
| 1840- | 40- | æ™®è·Œè¡Œæƒ… âŒ | æ§åˆ¶ä»“ä½ |

### è¶‹åŠ¿åˆ¤æ–­

**ä¸Šå‡è¶‹åŠ¿**ï¼š
```
- å¸‚åœºæ€»åˆ†æŒç»­ä¸Šå‡
- å¼ºåŠ¿è¡Œä¸šï¼ˆå¾—åˆ†>60ï¼‰æ•°é‡å¢åŠ 
- å¼±åŠ¿è¡Œä¸šï¼ˆå¾—åˆ†<40ï¼‰æ•°é‡å‡å°‘
â†’ å¸‚åœºè¶‹åŠ¿å¥åº·ï¼Œå¯ç»§ç»­æŒæœ‰
```

**ä¸‹é™è¶‹åŠ¿**ï¼š
```
- å¸‚åœºæ€»åˆ†æŒç»­ä¸‹é™
- å¼ºåŠ¿è¡Œä¸šæ•°é‡å‡å°‘
- å¼±åŠ¿è¡Œä¸šæ•°é‡å¢åŠ 
â†’ å¸‚åœºè¶‹åŠ¿è½¬å¼±ï¼Œéœ€è¦é˜²å®ˆ
```

**èƒŒç¦»ä¿¡å·**ï¼š
```
- æŒ‡æ•°ä¸Šæ¶¨ï¼Œä½†å¸‚åœºæ€»åˆ†ä¸‹é™
â†’ å°‘æ•°æƒé‡è‚¡æ‹‰æŠ¬ï¼Œå¸‚åœºå®½åº¦æ”¶çª„ï¼Œè­¦æƒ•å‡çªç ´

- æŒ‡æ•°ä¸‹è·Œï¼Œä½†å¸‚åœºæ€»åˆ†ä¸Šå‡
â†’ æƒé‡è‚¡æ‹–ç´¯ï¼Œä½†å¸‚åœºå‚ä¸åº¦æå‡ï¼Œå¯èƒ½æ˜¯è°ƒæ•´æœºä¼š
```

## ä¼˜åŠ¿ä¸å±€é™

### ä¼˜åŠ¿

1. âœ… **å®¢è§‚æ€§**ï¼šåŸºäºå®é™…æ¶¨è·Œæ•°æ®ï¼Œé¿å…ä¸»è§‚åˆ¤æ–­
2. âœ… **å…¨é¢æ€§**ï¼šè¦†ç›–æ‰€æœ‰è¡Œä¸šï¼Œåæ˜ å¸‚åœºæ•´ä½“çŠ¶å†µ
3. âœ… **æ•æ„Ÿæ€§**ï¼šèƒ½å¿«é€Ÿåæ˜ å¸‚åœºæƒ…ç»ªå˜åŒ–
4. âœ… **å¯è§†åŒ–**ï¼šçƒ­åŠ›å›¾ç›´è§‚å±•ç¤ºè¡Œä¸šè½®åŠ¨

### å±€é™

1. âš ï¸ **å¿½ç•¥æ¶¨è·Œå¹…åº¦**ï¼šåªçœ‹æ¶¨è·Œæ•°é‡ï¼Œä¸çœ‹æ¶¨è·Œå¹…åº¦
   - ä¾‹å¦‚ï¼š10åªè‚¡ç¥¨æ¶¨åœ = 100åªè‚¡ç¥¨å¾®æ¶¨ï¼ˆå¾—åˆ†ç›¸åŒï¼‰

2. âš ï¸ **è¡Œä¸šæƒé‡ä¸å‡**ï¼šä¸åŒè¡Œä¸šè‚¡ç¥¨æ•°é‡å·®å¼‚å¤§
   - ä¾‹å¦‚ï¼šè½¯ä»¶æœåŠ¡120åªï¼Œèˆªç©º40åªï¼Œå¾—åˆ†æƒé‡ç›¸åŒ

3. âš ï¸ **çŸ­æœŸæ³¢åŠ¨**ï¼šå•æ—¥æ•°æ®å¯èƒ½å—éšæœºå› ç´ å½±å“
   - å»ºè®®ï¼šç»“åˆå¤šæ—¥æ•°æ®è§‚å¯Ÿè¶‹åŠ¿

## æ”¹è¿›æ–¹å‘

### 1. åŠ æƒå¸‚åœºå®½åº¦

è€ƒè™‘è‚¡ç¥¨å¸‚å€¼æˆ–æˆäº¤é¢æƒé‡ï¼š

```python
# åŠ æƒå¾—åˆ† = Î£(ä¸Šæ¶¨è‚¡ç¥¨å¸‚å€¼) / Î£(è¡Œä¸šæ€»å¸‚å€¼) Ã— 100
weighted_score = (
    df[df['pct_chg'] > 0]['total_mv'].sum() /
    df['total_mv'].sum() * 100
)
```

### 2. å¹…åº¦åŠ æƒ

è€ƒè™‘æ¶¨è·Œå¹…åº¦ï¼š

```python
# å¹³å‡æ¶¨å¹… = Î£(pct_chg) / è‚¡ç¥¨æ•°é‡
avg_change = df.groupby('industry')['pct_chg'].mean()
```

### 3. åŠ¨æ€é˜ˆå€¼

æ ¹æ®å¸‚åœºçŠ¶æ€è°ƒæ•´ä¸Šæ¶¨å®šä¹‰ï¼š

```python
# è·‘èµ¢è¡Œä¸šå‡å€¼å³ç®—"ä¸Šæ¶¨"
industry_mean = df.groupby('industry')['pct_chg'].transform('mean')
df['outperform'] = df['pct_chg'] > industry_mean
```

## å‚è€ƒèµ„æ–™

- [Investopedia - Market Breadth](https://www.investopedia.com/terms/m/market-breadth.asp)
- [è…¾è½æŒ‡æ ‡ (ADL)](https://www.investopedia.com/terms/a/advancedeclineline.asp)
- [æ–°é«˜æ–°ä½æŒ‡æ ‡](https://www.investopedia.com/terms/n/new-highs-lows.asp)

---

**è®¡ç®—é€»è¾‘ä½ç½®**ï¼š`market_width.py` ç¬¬ 85-116 è¡Œ
**æ›´æ–°æ—¥æœŸ**ï¼š2025-12-26
